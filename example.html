<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
  <title>Asynchronous File Upload</title>
  <meta name="charset" content="UTF-8" />
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.4/jquery-ui.min.js" type="text/javascript"></script>
  <script src="jquery.async-file-upload.js" type="text/javascript"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $('#progress-bar').progressbar().hide();

      $('#upload_data').binaryUpload({
        url: $('#upload_data').parent('form').attr('action'),
        onProgress: function(evt) {
          if (evt.lengthComputable) {
            var percentComplete = parseInt(Number((evt.loaded/evt.total) * 100).toFixed())
            $('#progress-bar').progressbar('option', 'value', percentComplete);
          }
        },
        onStart: function(evt) {
          $('#progress-bar').show();
          $('#progress-bar').progressbar('option', 'value', 0);
        },
        onFinish: function(evt) {
          $('#progress-bar').progressbar('option', 'value', 100);
          $('#progress-bar').fadeOut('slow');
        },
        onError: function(evt) {
          console.log('Error');
        },
        onBrowserIncompatible: function() {
          alert('Bad browser')
        },
        fields: {
          'authenticity_token': 'fake-token',
          'format': 'js'
        }
      });
    });
  </script>
</head>
<body>

<form action="/uploads" method="post">
  <input id="upload_data" name="upload[data]" type="file" />
</form>

<br/>
<div id="progress-bar"></div>

</body>
</html>
